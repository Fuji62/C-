/*
 ============================================================================
 Name        : gren1.c
 Author      : 藤本智哉
 Description : 会員簿のデータを構造体の配列に記憶させ、フリガナの昇順に出力する
 ============================================================================
 */
/*
 ============================================================================
 Name        : gren1.c
 Author      : 藤本智哉
 Description : 会員簿のデータを構造体の配列に記憶させ、フリガナの昇順に出力する
 ============================================================================
 */
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#define NUMBER 15 //会員の人数
#define STR_LEN 128
//****************************************************************************
typedef struct{
	int id;
	char name[STR_LEN];
	char kana[STR_LEN];
	int birthday;
}Person;

Person member[] = {
	{   91, "玉江 カタル", "タマエ カタル",         20060813},
	{  902, "榎本 剛",     "エノモト ツヨシ",       20050903},
	{ 1903, "二神 龍太郎", "フタガミ リュウタロウ", 20070326},
	{ 1904, "田中 良美",   "タナカ ヨシミ",         20080608},
	{11905, "吉田 徹",     "ヨシダ トオル",         20090211},
	{11906, "高橋 純",     "タカハシ ジュン",       20060704},
	{11907, "今田 隆弘",   "イマダ タカヒロ",       20070823},
	{11908, "鈴木 博",     "スズキ ヒロシ",         20080619},
	{20012, "浦野 晶子",   "ウラノ ショウコ",       20091002},
	{21301, "井上 篤志",   "イノウエ アツシ",       20040719},
	{33002, "倉石 美鈴",   "クライシ ミスズ",       20080316},
	{35039, "小野寺 健",   "オノデラ ケン",         20071224},
	{37415, "山田 太朗",   "ヤマダ タロウ",         20080515},
	{40653, "浜崎 静香",   "ハマサキ シズカ",       20061119},
	{41063, "藤田 由貴",   "フジタ ユキ",           20051009}
};
//****************************************************************************
/* 会員の比較関数(x > yなら正の値、x == なら0、x<yなら負の値を返す) */
typedef int (*compare_func_ptr)(Person* x, Person* y);

//****************************************************************************
int compare_birthday(Person *x, Person *y){        /*会員の生年月日を比較*/
	if (x->birthday < y->birthday)
		return 1;
	if (x->birthday > y->birthday)
		return -1;
	return 0;
}
//****************************************************************************
int compare_kana(Person *x, Person *y){                     /*文字列の比較*/
	return strcmp(x->kana, y->kana);
}
//****************************************************************************
void swap_Person(Person *x, Person *y){                 /*会員データの交換*/
	Person temp = *x;
	*x = *y ;
	*y = temp ;
}
//****************************************************************************
void sort(Person a[], int n, compare_func_ptr compare){     /*昇順にソート*/
	int i, j ;
	for(i = 0; i < n - 1; i++){
		for(j = n - 1; j > i; j--)
			if(compare(&a[j - 1], &a[j]) > 0)
				swap_Person(&a[j - 1], &a[j]) ;
	}
}
//****************************************************************************
compare_func_ptr select_compare_function(const char** func_name){
	static struct{            /*メニューの候補*/
		const char *name;     /*比較関数の名前*/
		compare_func_ptr func; /*比較関数*/
	}menu[] = {
		{"生年月日順", compare_birthday},
		{"フリガナ順", compare_kana},
		{NULL, NULL} /*終了*/
	};
	int count = 0;
	int i;
	int select;
	/*メニューの数を数える*/
	while (menu[count].name != NULL) count++;
	do {
		/*メニューを表示*/
		puts("\n比較関数を選んでください。");
		for (i = 0; i < count; i++)
			printf("%d: %s\n", i, menu[i].name);
		/*プロンプトを表示*/
		printf("> ");
		fflush(stdout);
		/*入力を読み込みに失敗したら終了する*/
		if (scanf("%d", &select) != 1)
			return NULL;
	} while(select < 0 || count <= select); /*不正な入力なら再入力する*/
	/*選ばれた比較関数の情報を返す*/
	*func_name = menu[select].name;
	return menu[select].func;
}
//****************************************************************************
void print_data(Person *member){                       /*構造体データの出力*/
	printf("【会員データ】\n");
	printf(" ID　　 氏名　　　　フリガナ　　　　　　　　生年月日\n");
	for(int i = 0; i < NUMBER; i++){
		printf(" %05d\t%-14s\t%-28s\t%4d年%2d月%2d日\n",
		member[i].id, member[i].name, member[i].kana,
		member[i].birthday / 10000,
		member[i].birthday % 10000 / 100,
		member[i].birthday % 100 );
	}
}
//****************************************************************************
int main(void){
	compare_func_ptr func;
	const char *func_name = "";

	print_data(member);                              /* 構造体データの出力 */

	func = select_compare_function(&func_name);      /* ソートタイプの選択 */
	if(func == NULL){                                /* 文字列 or 数値 */
		return 1;
	}
	sort(member,NUMBER, func) ;                      /* 構造体のソート */
	printf("\n%sにソートしました。\n\n", func_name);

	print_data(member);                              /* 構造体データの出力 */

	return EXIT_SUCCESS;
}

/*
【会員データ】
 ID　　 氏名　　　　フリガナ　　　　　　　　生年月日
 00091	玉江 カタル	タマエ カタル         	2006年 8月13日
 00902	榎本 剛    	エノモト ツヨシ      	2005年 9月 3日
 01903	二神 龍太郎	フタガミ リュウタロウ	2007年 3月26日
 01904	田中 良美 	タナカ ヨシミ         	2008年 6月 8日
 11905	吉田 徹    	ヨシダ トオル         	2009年 2月11日
 11906	高橋 純    	タカハシ ジュン      	2006年 7月 4日
 11907	今田 隆弘 	イマダ タカヒロ      	2007年 8月23日
 11908	鈴木 博    	スズキ ヒロシ         	2008年 6月19日
 20012	浦野 晶子 	ウラノ ショウコ      	2009年10月 2日
 21301	井上 篤志 	イノウエ アツシ      	2004年 7月19日
 33002	倉石 美鈴 	クライシ ミスズ      	2008年 3月16日
 35039	小野寺 健 	オノデラ ケン         	2007年12月24日
 37415	山田 太朗 	ヤマダ タロウ         	2008年 5月15日
 40653	浜崎 静香 	ハマサキ シズカ      	2006年11月19日
 41063	藤田 由貴 	フジタ ユキ            	2005年10月 9日

比較関数を選んでください。
0: 生年月日順
1: フリガナ順
> 1

フリガナ順にソートしました。

【会員データ】
 ID　　 氏名　　　　フリガナ　　　　　　　　生年月日
 21301	井上 篤志 	イノウエ アツシ      	2004年 7月19日
 11907	今田 隆弘 	イマダ タカヒロ      	2007年 8月23日
 20012	浦野 晶子 	ウラノ ショウコ      	2009年10月 2日
 00902	榎本 剛    	エノモト ツヨシ      	2005年 9月 3日
 35039	小野寺 健 	オノデラ ケン         	2007年12月24日
 33002	倉石 美鈴 	クライシ ミスズ      	2008年 3月16日
 11908	鈴木 博    	スズキ ヒロシ         	2008年 6月19日
 11906	高橋 純    	タカハシ ジュン      	2006年 7月 4日
 01904	田中 良美 	タナカ ヨシミ         	2008年 6月 8日
 00091	玉江 カタル	タマエ カタル         	2006年 8月13日
 40653	浜崎 静香 	ハマサキ シズカ      	2006年11月19日
 41063	藤田 由貴 	フジタ ユキ            	2005年10月 9日
 01903	二神 龍太郎	フタガミ リュウタロウ	2007年 3月26日
 37415	山田 太朗 	ヤマダ タロウ         	2008年 5月15日
 11905	吉田 徹    	ヨシダ トオル         	2009年 2月11日

*/
